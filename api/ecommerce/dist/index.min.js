var C=Object.create;var f=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var J=(t,r,o,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let e of x(r))!_.call(t,e)&&e!==o&&f(t,e,{get:()=>r[e],enumerable:!(s=k(r,e))||s.enumerable});return t};var a=(t,r,o)=>(o=t!=null?C(T(t)):{},J(r||!t||!t.__esModule?f(o,"default",{value:t,enumerable:!0}):o,t));var P=a(require("@groupclaes/fastify-elastic")),F=a(require("@groupclaes/fastify-authhandler"));var y=a(require("mssql"));var h=require("mssql"),g=require("./config"),c=new Map,n={get:async t=>{if(!c.has(t)){if(!g.mssql[t])throw new Error(`Configuration for pool '${t}' does not exist!`);let r=new h.ConnectionPool(g.mssql[t]),o=r.close.bind(r);r.close=(...s)=>(c.delete(t),o(...s)),c.set(t,await r.connect())}return c.get(t)},closeAll:()=>Promise.all(Array.from(c.values()).map(t=>t.then(r=>r.close())))};var W="brabopak",i=class{constructor(){this.schema="[ecommerce]."}async getTree(r,o="nl"){try{let s=new y.default.Request(await n.get(W));s.input("user_id",y.default.Int,r),s.input("culture",y.default.VarChar,o);let e=await s.execute(this.schema+"[usp_getCategoriesTree]");return e.recordset.length>0?e.recordset[0]:void 0}catch(s){throw s}}};var b=async(t,r)=>{try{let o=new i,s=t.token||{sub:null},e=t.query.culture??"nl";return await o.getTree(s.sub,e)}catch(o){return r.status(500).send(o)}};var l=a(require("mssql"));var A="brabopak",m=class{constructor(){this.schema="[ecommerce]."}async get(r,o,s="nl"){try{let e=new l.default.Request(await n.get(A));e.input("user_id",l.default.Int,o),e.input("usercode",l.default.Int,r),e.input("culture",l.default.VarChar,s);let u=await e.execute(this.schema+"[usp_getCart]");return u.recordset.length>0?u.recordset[0]:void 0}catch(e){throw e}}};var w=async(t,r)=>{try{let o=new m,s=t.token||{sub:null},e=t.query.culture??"nl"}catch(o){return r.status(500).send(o)}};var p=a(require("mssql"));var I="brabopak",d=class{constructor(){this.schema="[ecommerce]."}async get(r,o,s="nl"){try{let e=new p.default.Request(await n.get(I));e.input("user_id",p.default.Int,o),e.input("usercode",p.default.Int,r),e.input("culture",p.default.VarChar,s);let u=await e.execute(this.schema+"[usp_getDashboard]");return u.recordset.length>0?u.recordsets:void 0}catch(e){throw e}}};var q=async(t,r)=>{try{let o=new d,s=t.token||{sub:null},e=t.query.culture??"nl";return await o.get(t.query.usercode,s.sub,e)}catch(o){return r.status(500).send(o)}};var R=[{method:"GET",url:"/menu",handler:b},{method:"GET",url:"/carts",handler:w,requiredPermissions:[]},{method:"GET",url:"/dashboard",handler:q,requiredPermissions:[]}];var Q=require("./config"),B=async()=>{let t=new P.default(Q.wrapper);t.addAuthPreHandler(F.default,"token"),t.routeMultiple(R),await t.start()};B();
